<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Memory Shape Drawing Game</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      font-family: sans-serif;
      background-color: #f0f0f0;
      user-select: none;
      touch-action: none;
    }
    canvas {
      display: block;
      margin: 10px auto;
      background: white;
      border: 1px solid red;
      border-radius: 6px;
    }
    .controls, .switches-group, .checkboxes-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 10px;
      align-items: center;
    }
    .score {
      text-align: center;
      font-weight: bold;
      min-height: 1.5em;
    }
    .switch-label-container {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #2196F3;
    }
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    .switch-text {
      margin-left: 8px;
      user-select: none;
      font-size: 14px;
      white-space: nowrap;
    }
    .checkboxes-group label {
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center">Memory Shape Drawing Game</h2>

  <div class="controls">
    <label>Time (sec):
      <input type="number" id="timeInput" value="5" min="1" max="60">
    </label>
    <label>Sides:
      <select id="sidesSelect">
        <option value="1">Point</option>
        <option value="2">Line Segment</option>
        <option value="3">3</option>
        <option value="4" selected>4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
      </select>
    </label>
    <label>Size:
      <select id="sizeSelect">
        <option value="small">Small</option>
        <option value="medium" selected>Medium</option>
        <option value="big">Big</option>
      </select>
    </label>
    <label>Grid:
      <select id="gridSelect">
        <option value="0">None</option>
        <option value="2">2x2</option>
        <option value="3">3x3</option>
        <option value="4">4x4</option>
      </select>
    </label>
  </div>

  <div class="switches-group">
    <label class="switch-label-container">
      <div class="switch">
        <input type="checkbox" id="drawModeToggle" checked />
        <span class="slider"></span>
      </div>
      <span class="switch-text" id="drawModeLabel">Point-to-Point</span>
    </label>
  </div>

  <div class="checkboxes-group">
    <label><input type="checkbox" id="giveHighest" /> Highest</label>
    <label><input type="checkbox" id="giveLowest" /> Lowest</label>
    <label><input type="checkbox" id="giveLeftmost" /> Left-most</label>
    <label><input type="checkbox" id="giveRightmost" /> Right-most</label>
  </div>

  <div class="controls">
    <button onclick="newShape()">New Shape</button>
    <button onclick="previousShape()">Previous Shape</button>
    <button onclick="retryShape()">Retry Shape</button>
  </div>

  <canvas id="gameCanvas" width="500" height="500"></canvas>
  <p class="score" id="result"></p>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const drawModeToggle = document.getElementById("drawModeToggle");
    const drawModeLabel = document.getElementById("drawModeLabel");
    const gridSelect = document.getElementById("gridSelect");
    const result = document.getElementById("result");

    let originalShape = [];
    let playerShape = [];
    let isDrawing = false;
    let drawingEnabled = false;
    let lastShape = [];
    let viewTimer = null;

    drawModeToggle.addEventListener("change", () => {
      drawModeLabel.textContent = drawModeToggle.checked ? "Point-to-Point" : "Freehand";
    });

    canvas.addEventListener("pointerdown", (e) => {
      if (!drawingEnabled) return;
      const pos = getCanvasPos(e);
      if (drawModeToggle.checked) {
        playerShape.push(pos);
        drawDots();
        if (playerShape.length === originalShape.length) {
          setTimeout(revealShape, 300);
        }
      } else {
        isDrawing = true;
        playerShape = [pos];
        drawFreehand();
      }
    });

    canvas.addEventListener("pointermove", (e) => {
      if (!drawingEnabled || drawModeToggle.checked || !isDrawing) return;
      const pos = getCanvasPos(e);
      playerShape.push(pos);
      drawFreehand();
    });

    canvas.addEventListener("pointerup", () => {
      if (!drawingEnabled || drawModeToggle.checked) return;
      isDrawing = false;
      revealShape();
    });

    function getCanvasPos(e) {
      const rect = canvas.getBoundingClientRect();
      return {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
      };
    }

    function getTimeMs() {
      const sec = parseFloat(document.getElementById("timeInput").value);
      return Math.max(1000, sec * 1000);
    }

    function newShape() {
      clearTimeout(viewTimer);
      const sides = parseInt(document.getElementById("sidesSelect").value);
      const time = getTimeMs();
      lastShape = originalShape.map(p => ({ ...p }));
      originalShape = generateShape(sides);
      playerShape = [];
      drawingEnabled = false;
      result.textContent = "";
      clearCanvas();
      drawGrid();
      drawShape(originalShape, "black");
      viewTimer = setTimeout(() => {
        clearCanvas();
        drawGrid();
        drawGivenPoints(originalShape);
        drawingEnabled = true;
      }, time);
    }

    function previousShape() {
      clearTimeout(viewTimer);
      if (!lastShape.length) return;
      originalShape = lastShape.map(p => ({ ...p }));
      playerShape = [];
      drawingEnabled = false;
      result.textContent = "";
      clearCanvas();
      drawGrid();
      drawShape(originalShape, "black");
      const time = getTimeMs();
      viewTimer = setTimeout(() => {
        clearCanvas();
        drawGrid();
        drawGivenPoints(originalShape);
        drawingEnabled = true;
      }, time);
    }

    function retryShape() {
      clearTimeout(viewTimer);
      const time = getTimeMs();
      playerShape = [];
      drawingEnabled = false;
      result.textContent = "";
      clearCanvas();
      drawGrid();
      drawShape(originalShape, "black");
      viewTimer = setTimeout(() => {
        clearCanvas();
        drawGrid();
        drawGivenPoints(originalShape);
        drawingEnabled = true;
      }, time);
    }

    function generateShape(sides) {
      if (sides === 1) {
        return [{
          x: Math.random() * (canvas.width - 40) + 20,
          y: Math.random() * (canvas.height - 40) + 20
        }];
      }

      const sizeMap = {
        small: 60,
        medium: 120,
        big: 180
      };
      const selectedSize = document.getElementById("sizeSelect").value;
      const radius = sizeMap[selectedSize] || 120;

      const cx = canvas.width / 2;
      const cy = canvas.height / 2;
      const angleOffset = Math.random() * Math.PI * 2;

      const points = [];
      const angleStep = (2 * Math.PI) / sides;

      for (let i = 0; i < sides; i++) {
        const angle = angleStep * i + angleOffset;
        const r = radius * (0.9 + Math.random() * 0.2);
        points.push({
          x: cx + r * Math.cos(angle),
          y: cy + r * Math.sin(angle)
        });
      }

      return points;
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function drawGrid() {
      const gridVal = parseInt(gridSelect.value);
      if (gridVal < 2) return;
      const spacing = canvas.width / gridVal;
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 0.5;
      for (let i = 1; i < gridVal; i++) {
        let pos = spacing * i;
        ctx.beginPath();
        ctx.moveTo(pos, 0);
        ctx.lineTo(pos, canvas.height);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(0, pos);
        ctx.lineTo(canvas.width, pos);
        ctx.stroke();
      }
    }

    function drawShape(points, color) {
      if (points.length === 1) {
        drawDot(points[0], color);
        return;
      }
      ctx.beginPath();
      ctx.moveTo(points[0].x, points[0].y);
      for (let i = 1; i < points.length; i++) {
        ctx.lineTo(points[i].x, points[i].y);
      }
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.strokeStyle = color;
      ctx.lineWidth = 2;
      ctx.fill();
      ctx.stroke();
    }

    function drawGivenPoints(points) {
      const extremes = {
        top: points.reduce((a, b) => (a.y < b.y ? a : b)),
        bottom: points.reduce((a, b) => (a.y > b.y ? a : b)),
        left: points.reduce((a, b) => (a.x < b.x ? a : b)),
        right: points.reduce((a, b) => (a.x > b.x ? a : b))
      };
      if (document.getElementById("giveHighest").checked) drawDot(extremes.top, "blue");
      if (document.getElementById("giveLowest").checked) drawDot(extremes.bottom, "blue");
      if (document.getElementById("giveLeftmost").checked) drawDot(extremes.left, "blue");
      if (document.getElementById("giveRightmost").checked) drawDot(extremes.right, "blue");
    }

    function drawDot(pt, color) {
      ctx.beginPath();
      ctx.arc(pt.x, pt.y, 5, 0, 2 * Math.PI);
      ctx.fillStyle = color;
      ctx.fill();
    }

    function drawDots() {
      clearCanvas();
      drawGrid();
      drawGivenPoints(originalShape);
      for (const pt of playerShape) {
        drawDot(pt, "red");
      }
    }

    function revealShape() {
      drawingEnabled = false;
      clearCanvas();
      drawGrid();
      drawShape(originalShape, "black");

      if (!playerShape.length) return;

      if (playerShape.length > 1) {
        ctx.beginPath();
        ctx.moveTo(playerShape[0].x, playerShape[0].y);
        for (let i = 1; i < playerShape.length; i++) {
          ctx.lineTo(playerShape[i].x, playerShape[i].y);
        }
        ctx.closePath();
        ctx.strokeStyle = "red";
        ctx.lineWidth = 2;
        ctx.stroke();
      }

      for (let i = 0; i < playerShape.length; i++) {
        const p = playerShape[i];
        const closest = originalShape.reduce((min, q) => {
          const d = Math.hypot(p.x - q.x, p.y - q.y);
          return d < min.d ? { d, q } : min;
        }, { d: Infinity });

        let color = "red";
        if (closest.d <= 5) color = "green";
        else if (closest.d <= 10) color = "orange";

        ctx.fillStyle = color;
        ctx.font = "16px sans-serif";
        ctx.fillText((i + 1), p.x + 6, p.y - 6);
      }

      result.textContent = "Reveal complete.";
    }

    function drawFreehand() {
      clearCanvas();
      drawGrid();
      drawGivenPoints(originalShape);
      if (playerShape.length < 2) return;
      ctx.beginPath();
      ctx.moveTo(playerShape[0].x, playerShape[0].y);
      for (let i = 1; i < playerShape.length; i++) {
        ctx.lineTo(playerShape[i].x, playerShape[i].y);
      }
      ctx.strokeStyle = "red";
      ctx.lineWidth = 1.5;
      ctx.stroke();
    }
  </script>
</body>
</html>

